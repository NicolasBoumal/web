<title>
    Max-Trace on Stiefel
</title>

<p>
We are interested in the following problem, which comes up sometimes when doing optimization on manifolds. Let $A \in \reals^{n \times n}$ be a symmetric matrix. Consider the problem
\begin{aligned}
    \max_{X \in \text{St}(n,p)} \trace \left ( X^\top A X \right ),
\end{aligned}
where $\text{St}(n,p) = \{X \in \reals^{n \times p} : X^\top X = I_p\}$ is the Stiefel manifold.
</p>

<question>
    Show that the solution to this problem is the sum of the $p$ largest eigenvalues of $A$, i.e.,
    \begin{aligned}
        \max_{X \in \text{St}(n,p)} \trace \left ( X^\top A X \right ) = \sum_{i=1}^p \lambda_i(A),
    \end{aligned}
    where $\lambda_1(A) \geq \ldots \geq \lambda_n(A)$ are the eigenvalues of $A$.
</question>
<sketch>
    First, use the spectral theorem to rewrite the problem with $A$ diagonal. Then, show that
    \begin{aligned}
        \max_{X \in \text{St}(n,p)} \trace \left ( X^\top A X \right ) \leq \max_{t \in K_{n,p}} \langle \lambda, t \rangle
    \end{aligned}
    with $\lambda = (\lambda_1(A), \ldots, \lambda_n(A))$ and $K_{n,p} = \{t \in \reals^n : t \in [0,1], \; ||t||_1 = p\}$. Finally, show that
    \begin{aligned}
        \max_{t \in K_{n,p}} \langle \lambda, t \rangle = \sum_{i=1}^p \lambda_i(A).
    \end{aligned}
</sketch>
<answer>
    As $A \in  \reals^{n \times n}$ is symmetric there exists $U \in \mathcal{O}(n)$, $\Lambda = \text{diag}(\lambda_1(A), \ldots, \lambda_n(A))$ such that $A = U^\top \Lambda U$. In the following we write $\lambda_i$ instead of $\lambda_i(A)$ for simplicity. As
	\begin{aligned}
		X \in \text{St}(n,p) \mapsto UX \in \text{St}(n,p)
	\end{aligned}
	is a bijection we get that
	\begin{aligned}
		\max_{X \in \text{St}(n,p)} \trace \left ( X^\top A X \right ) = \max_{X \in \text{St}(n,p)} \trace \left ( X^\top \Lambda X \right ).
	\end{aligned}
	Now, observe that for $X \in \text{St}(n,p)$ it holds that
	\begin{aligned}
		\trace \left (X^\top \Lambda X \right ) = \trace \left (\begin{bmatrix}
			\lambda_1 x_1 & \ldots & \lambda_n x_n
		\end{bmatrix} X \right ) = \trace \left ( \sum_{i=1}^n \lambda_i x_i x_i^\top \right ) = \sum_{i=1}^n \lambda_i \trace (x_i x_i^\top) = \sum_{i=1}^n \lambda_i ||x_i||^2
	\end{aligned}
	with $X = \begin{bmatrix}
			 x_1 & \ldots & x_n
		\end{bmatrix}$.
	Further, as $X \in \text{St}(n,p)$ there exists $X_\perp \in \reals^{n \times (n-p)}$ such that $\begin{bmatrix}
			X & X_\perp
	\end{bmatrix} \in \mathcal{O}(n)$. From that it follows that $||x_i||^2 \leq 1$. Observe also that
	\begin{aligned}
		\sum_{i=1}^n ||x_i||^2 = ||X||^2_F = p.
	\end{aligned}
	This shows that
	\begin{aligned}
		\max_{X \in \text{St}(n,p)} \trace \left ( X^\top A X \right ) \leq \max_{t \in K_{n,p}} \langle \lambda, t \rangle
	\end{aligned}
	with $\lambda = (\lambda_1, \ldots, \lambda_n)$ and $K_{n,p} = \{t \in \reals^n : t \in [0,1], \; ||t||_1 = p\}$. We prove by induction on $n \in \mathbb{N}$ that
	\begin{aligned}
		\forall n \in \mathbb{N}, 1 \leq p \leq n \text{ we have that } \max_{t \in K_{n,p}} \langle \lambda, t \rangle = \sum_{i=1}^p \lambda_i.
	\end{aligned}
	If $n=1$, then $p=1$ and $K_{1,1}=\{1\}$. Thus
	\begin{aligned}
		\max_{t \in K_{n,p}} \langle \lambda, t \rangle = \max_{\{1\}}  (\lambda \cdot t) = \lambda.
	\end{aligned}
	Let $n \geq 2$ and suppose that it holds for $n-1 \geq 1$. Fix $1 \leq p \leq n$. As $K_{n,p}$ is clearly compact (it is closed and bounded) and the map $t \mapsto \langle \lambda, t \rangle$ is continuous, we have that there exists $\overline t \in K_{n,p}$ such that
	\begin{aligned}
		\max_{t \in K_{n,p}} \langle \lambda, t \rangle = \langle \lambda, \overline t \rangle.
	\end{aligned}
	Define $m:= \{i : \overline{t}_i \neq 0 \}$ and observe that $p \leq m$. If $\lambda_1 = \lambda_m$, then
	\begin{aligned}
		\max_{t \in K_{n,p}} \langle \lambda, t \rangle = \langle \lambda, \overline t \rangle = \sum_{i=1}^n \lambda_i \overline{t}_i = \lambda_1 \sum_{i=1}^m \overline{t}_i = \lambda_1 p  = \sum_{i=1}^p \lambda_i.
	\end{aligned}
	If $\lambda_1 > \lambda_m$, then $\overline{t}_1 = 1$ as otherwise we have a contradiction with the maximality of $\overline{t}$. If $p=1$, then as $\overline{t}_1 = 1$ we have that $\overline{t} = (1, \ldots,0)$ and thus
	\begin{aligned}
		\max_{t \in K_{n,p}} \langle \lambda, t \rangle = \langle \lambda, \overline t \rangle = \lambda_1.
	\end{aligned}
	If $p \geq 2$, then
	\begin{aligned}
		\max_{t \in K_{n,p}} \langle \lambda, t \rangle = \langle \lambda, \overline t \rangle = \lambda_1 + \max_{t \in K_{(n-1),(p-1)}} \sum_{i=2}^n \lambda_i t_i.
	\end{aligned}
	By induction assumption we have that
	\begin{aligned}
		\max_{t \in K_{(n-1),(p-1)}} \sum_{i=2}^n \lambda_i t_i = \sum_{i=2}^{p} \lambda_i.
	\end{aligned}
	Thus we get that
	\begin{aligned}
		\max_{t \in K_{n,p}} \sum_{i=1}^n \lambda_i t_i = \sum_{i=1}^{p} \lambda_i.
	\end{aligned}
	This shows that
	\begin{aligned}
		\max_{X \in \text{St}(n,p)} \trace \left ( X^\top A X \right ) \leq \sum_{i=1}^p \lambda_i.
	\end{aligned}
	To show that the bound can be attained, take $U \in \text{St}(n,p)$ such that the $i$th column of $U$ called $u_i \in \reals^n$ is an eigenvector of $A$ associated to $\lambda_i(A)$. Then we have
	\begin{aligned}
		\trace \left ( U^\top A U \right ) = \sum_{i=1}^p \lambda_i ||u_i||^2 =  \sum_{i=1}^p \lambda_i.
	\end{aligned}
	This proves the claim.
</answer>
